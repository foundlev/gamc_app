<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8" />
    <title>AeroDesk</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/fontawesome/css/all.min.css">
    <link rel="stylesheet" href="main.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#f8fafc">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="icon" href="favicon.svg" sizes="100x100" type="image/svg+xml">
    <link rel="apple-touch-icon" href="logo.svg" sizes="100x100" type="image/svg+xml">
</head>

<body>

    <nav class="sidebar">
        <button id="infoBtn" class="sidebar-btn" title="Информация">
            <i class="fa-solid fa-circle-info"></i>
        </button>
        <button id="offlineToggleBtn" class="sidebar-btn" title="Оффлайн режим">
            <i class="fa-solid fa-signal"></i>
        </button>

        <div class="sidebar-sep"></div>

        <button id="routeSelectContainer" class="sidebar-btn" title="Маршруты">
            <i class="fa-solid fa-route"></i>
            <span id="routeSelectLabel" style="display: none;">Недавние</span>
        </button>
        <button id="editRouteBtn" class="sidebar-btn" title="Добавить/Изменить маршрут">
            <i class="fa-solid fa-plus"></i>
        </button>
        <button id="reverseRouteBtn" class="sidebar-btn" title="Обратный маршрут" hidden>
            <i class="fa-solid fa-arrow-right-arrow-left"></i>
        </button>
        
        <select id="routeSelect" style="display: none;">
            <option value="recent" selected>Недавние</option>
            <option value="temp">Автоподбор</option>
        </select>

        <div class="sidebar-sep"></div>

        <button id="refreshAllBtn" class="sidebar-btn" title="Обновить всё">
            <i class="fa-solid fa-retweet"></i>
            <div class="progress-fill"></div>
        </button>
        <button id="systemsInfoBtn" class="sidebar-btn" disabled onclick="showLandingSystemModal()" title="Системы аэродрома">
            <i class="fa-solid fa-tower-cell"></i>
        </button>
        <div class="sidebar-sep"></div>
        <button id="restrBtn" class="sidebar-btn" title="Ограничения">
            <i class="fa-solid fa-ruler-combined"></i>
        </button>
        <button id="settingsBtn" class="sidebar-btn" title="Настройки">
            <i class="fa-solid fa-gear"></i>
        </button>
    </nav>

    <div class="app-wrapper">
    <main>
        <div class="input-group">
            <div class="input-group icao-input-wrapper">
                <div class="input-group-row">
                    <div class="input-with-clear">
                        <input type="text" id="icao" placeholder="ICAO" maxlength="4" />
                        <button type="button" class="clear-icao-btn" id="clearIcaoBtn"><i class="fa-solid fa-eraser"></i><span>Стереть</span></button>
                        <ul id="icaoSuggestions" class="icao-suggestions"></ul>
                    </div>
                    <button id="fetchBtn" disabled><i class="fas fa-cloud-download-alt"></i><span>Запросить</span></button>
                    <button id="searchBtn"><i class="fa-solid fa-magnifying-glass"></i><span>Поиск</span></button>
                </div>
            </div>

        </div>

        <!-- Здесь будет либо 10 аэродромов (как раньше), либо список из маршрута -->
        <div class="history" id="historyContainer"></div>

        <div class="airport-info-bar" id="airportInfoContainer" style="display: none;">
            <!-- Слева (самолёт + ICAO/IATA) -->
            <div class="airport-left">
                <i class="fa-solid fa-plane-up"></i>
                <span id="airportCodes"></span>
            </div>

            <!-- По центру: Название и страна (мелким шрифтом) -->
            <div class="airport-center">
                <div class="airport-name" id="airportName"></div>
                <div class="airport-subinfo">
                    <span class="airport-country" id="airportCountry"></span>
                </div>
            </div>

            <div class="airport-right">
                <i class="fa-solid fa-mountain"></i>
                <span id="airportElevation"></span>
            </div>
        </div>

        <!-- Плашки с временем -->
        <div class="upper-badge-container" id="upperBadgeContainer">
            <div class="time-badge-container remove-bottom-gap" id="timeBadgeContainer"></div>
            <div class="time-badge-container remove-bottom-gap" id="timeBadgeContainerRow2"></div>
            <div class="time-badge-container remove-bottom-gap" id="favBadgeContainer"></div>
        </div>

        <!-- Основной контейнер для данных -->
        <div class="response-container" id="responseContainer">
            <div class="placeholder">
                <i class="fa-solid fa-cloud-sun fa-2x"></i>
                <p>Введите ICAO код аэродрома, чтобы увидеть погоду</p>
            </div>
        </div>
    </main>

    </div> <!-- .app-wrapper -->

    <div class="modal-backdrop" id="infoModalBackdrop">
        <div class="modal info-modal">
            <div class="info-top-bar">
                <button id="reloadBtn" class="info-reload-btn" title="Перезагрузить страницу">
                    <i class="fa-solid fa-rotate-right"></i>
                    <span>Перезагрузить</span>
                </button>
                <button class="modal-close-btn info-close-btn" id="closeInfoModalBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="info-header">
                <i class="fa-solid fa-plane-circle-check fa-3x" style="color: var(--accent-color);"></i>
                <div class="info-title-group">
                    <h2>AeroDesk App</h2>
                    <span id="changelogBtn" class="version-badge">v2.0.6 Beta</span>
                </div>
            </div>
            
            <div class="info-content">
                <div class="info-content-top">
                    <p><i class="fa-solid fa-triangle-exclamation"></i> Перепроверяйте данные.</p>
                    <p>Источник: <a href="https://meteoinfo.gamc.ru" target="_blank" rel="noopener noreferrer">meteoinfo.gamc.ru</a></p>
                </div>

                <div class="info-sep"></div>

                <div class="info-changelog">
                    <h3>Журнал изменений</h3>
                    <div id="changelogContent" class="changelog-content">
                        <!-- Список обновлений будет вставляться сюда -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-backdrop" id="routeSearchModalBackdrop">
        <div class="modal">
            <button class="modal-close-btn" id="closeRouteSearchModalBtn">
                <i class="fas fa-times"></i>
            </button>
            <h2>Поиск маршрута</h2>
            <div class="route-search-container">
                <input type="text" id="routeSearchInput" placeholder="Поиск по ICAO или названию..." autofocus />
            </div>
            <div class="route-quick-actions">
                <button id="quickRecentBtn" class="quick-action-btn">
                    <i class="fas fa-history"></i> Недавние
                </button>
                <button id="quickAddBtn" class="quick-action-btn">
                    <i class="fas fa-plus"></i> Создать новый
                </button>
                <button id="quickTemplateBtn" class="quick-action-btn">
                    <i class="fas fa-route"></i> Автоподбор
                </button>
            </div>
            <div id="routeSearchResults" class="route-search-results">
                <!-- Сюда будут рендериться результаты поиска -->
            </div>
        </div>
    </div>

    <!-- Контейнер для модального окна информации об аэродроме -->
    <div class="modal-backdrop" id="airportDetailsModalBackdrop">
        <div class="modal">
            <button class="modal-close-btn" id="closeAirportDetailsModalBtn"><i class="fas fa-times"></i></button>
            <h2 id="airportDetailsTitle">Информация об аэродроме</h2>
            <div class="modal-content-scrollable" id="airportDetailsContent">
                <!-- Сюда будет рендериться информация об аэродроме -->
            </div>
        </div>
    </div>

    <!-- Модальное окно для пароля -->
    <div class="modal-backdrop" id="modalBackdrop">
        <div class="modal">
            <button class="modal-close-btn" id="closeModalBtn"><i class="fas fa-times"></i></button>
            <h2>Введите пароль</h2>
            <input type="password" id="modalPassword" placeholder="Ваш пароль" />
            <div class="modal-button-group">
                <button id="savePasswordBtn">Сохранить</button>
            </div>
        </div>
    </div>

    <!-- Модальное окно для подтверждения действия -->
    <div class="modal-backdrop" id="confirmModalBackdrop">
        <div class="modal">
            <button class="modal-close-btn" id="closeConfirmModalBtn">
                <i class="fas fa-times"></i>
            </button>
            <h2 id="confirmModalTitle">Подтверждение</h2>
            <p id="confirmModalMessage">Вы уверены?</p>
            <div id="confirmModalExtra" style="display: none; margin-bottom: 15px;">
                <label class="custom-checkbox">
                    <input type="checkbox" id="confirmModalCheckbox">
                    <span id="confirmModalCheckboxLabel">Обновить все аэродромы</span>
                </label>
            </div>
            <div class="modal-button-group">
                <button id="confirmYesBtn">Да</button>
                <button id="confirmNoBtn">Нет</button>
            </div>
        </div>
    </div>

    <!-- Контейнер для модального окна состояния ВПП -->
    <div class="modal-backdrop runway-info-modal-backdrop" id="runwayInfoModal">
        <div class="modal">
            <button class="modal-close-btn" id="closeRunwayInfoModalBtn"><i class="fas fa-times"></i></button>
            <h2><i class="fa-solid fa-road"></i> Состояние ВПП</h2>
            <div id="runwayInfoContent">
                <!-- Сюда рендерится контент из decodeRunwayInfo -->
            </div>
        </div>
    </div>

    <!-- Контейнер для модального окна информации о ветре -->
    <div class="modal-backdrop wind-info-modal-backdrop" id="windInfoModal">
        <div class="modal">
            <button class="modal-close-btn" id="closeWindInfoModalBtn"><i class="fas fa-times"></i></button>
            <h2>Информация о ветре</h2>
            <p id="windInfoContent">Здесь будет информация о ветре...</p>
        </div>
    </div>

    <!-- Контейнер для модального окна расшифровки погоды -->
    <div class="modal-backdrop" id="weatherPhenomenaModalBackdrop">
        <div class="modal">
            <button class="modal-close-btn" id="closeWeatherPhenomenaModalBtn"><i class="fas fa-times"></i></button>
            <h2><i class="fa-solid fa-cloud-sun"></i> Расшифровка погоды</h2>
            <div class="modal-content-scrollable" id="weatherPhenomenaContent">
                <!-- Сюда будет рендериться расшифровка -->
            </div>
        </div>
    </div>

    <!-- Контейнер для модального окна информации о тех обслуживании -->
    <div class="modal-backdrop wind-info-modal-backdrop" id="maintenanceInfoModal">
        <div class="modal">
            <button class="modal-close-btn" id="closeMaintenanceInfoModalBtn"><i class="fas fa-times"></i></button>
            <h2>Информация об аэродроме</h2>
            <div class="modal-content-scrollable">
                <p id="maintenanceInfoContent">Здесь будет информация о техническом обслуживании</p>
            </div>
        </div>
    </div>

    <!-- Новое модальное окно настроек -->
    <div class="modal-backdrop" id="settingsModalBackdrop">
        <div class="modal">
            <button class="modal-close-btn" id="closeSettingsModalBtn"><i class="fas fa-times"></i></button>
            <h2>Настройки</h2>
            <div class="modal-content-scrollable">
                <div class="modal-button-container">
                    <button id="removeSavedIcaos" class="modal-button"><i class="fa-solid fa-trash"></i>Удалить сохранения</button>
                    <div class="password-block">
                        <button id="resetPasswordBtn" class="modal-button"><i class="fas fa-unlock-alt"></i>Сбросить пароль</button>
                        <button id="showPasswordBtn"  class="modal-button"><i class="fa-solid fa-eye"></i></button>
                    </div>
                    <div class="zoom-controls-row">
                        <button id="resetZoomBtn" class="modal-button"><i class="fas fa-compress-arrows-alt"></i>Сбросить масштаб</button>
                        <button id="zoomInBtn" class="modal-button zoom-btn"><i class="fas fa-search-plus"></i></button>
                        <button id="zoomOutBtn" class="modal-button zoom-btn"><i class="fas fa-search-minus"></i></button>
                    </div>
                    <div id="gamcUidContainer">
                        <input type="text" id="gamcUidInput" value="" readonly maxlength="6" />
                        <button id="editGamcUidBtn">
                            <i class="fas fa-pencil-alt"></i>
                        </button>
                    </div>
                    <div class="two-column-buttons">
                        <button id="loadGamcUidBtn" disabled>
                            <i class="fas fa-download"></i>Загрузить
                        </button>
                        <button id="exportGamcUidBtn" disabled>
                            <i class="fas fa-upload"></i>Выгрузить
                            <span class="export-indicator"></span>
                        </button>
                    </div>
                    <div class="setting-row">
                        <label for="aircraftTypeSelect">Тип ВС (maintenance support):</label>
                        <select id="aircraftTypeSelect">
                            <option value="B737">B737</option>
                            <option value="A320N,A321N">A320N, A321N</option>
                            <option value="A320,A320S,A321,A321S">A320, A320S, A321, A321S</option>
                            <option value="B777">B777</option>
                            <option value="A330">A330</option>
                            <option value="A350">A350</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <label for="atisLangSelect">Язык частоты АТИС:</label>
                        <select id="atisLangSelect">
                            <option selected value="EN">EN</option>
                            <option value="RU">RU</option>
                            <option value="EN">中文</option>
                        </select>
                    </div>
                    <div class="modal-checkbox-group">
                        <label class="custom-checkbox">
                            <input type="checkbox" id="showAirportInfoCheckbox">
                            <span>Отображать информацию об аэродроме</span>
                        </label>
                        <label class="custom-checkbox">
                            <input type="checkbox" id="doHighlightCheckbox">
                            <span>Выделение и расшифровка метеокода</span>
                        </label>
                        <label class="custom-checkbox">
                            <input type="checkbox" id="doMarkBagdeCheckbox">
                            <span>Выделять плашки аэродромов с техобслуживанием ВС</span>
                        </label>
                        <label class="custom-checkbox">
                            <input type="checkbox" id="autoOfflineCheckbox">
                            <span>Автоматически включать режим оффлайн, если нет интернета</span>
                        </label>
                        <div class="setting-row-inline" id="serverCheckRow">
                            <label class="custom-checkbox no-margin">
                                <input type="checkbox" id="checkServerConnCheckbox">
                                <span>Проверять подключение к серверу</span>
                            </label>
                            <select id="serverCheckIntervalSelect" class="small-select" title="Интервал проверки" style="display: none; width: 70px;">
                                <option value="5">5с</option>
                                <option value="15">15с</option>
                                <option value="30" selected>30с</option>
                                <option value="60">60с</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно для добавления маршрута -->
    <div class="modal-backdrop" id="addRouteModalBackdrop">
        <div class="modal">
            <button class="modal-close-btn" id="closeAddRouteModalBtn">
                <i class="fas fa-times"></i>
            </button>
            <h2>Добавить маршрут</h2>

            <!-- Блок Вылет и Назначение в одну строку -->
            <div class="route-main-row">
                <div class="icao-field-group">
                    <label for="departureIcao">
                        <i class="fa-solid fa-plane-departure"></i>Вылет:
                    </label>
                    <div style="position: relative;">
                        <input type="text" id="departureIcao" maxlength="4" placeholder="XXXX" />
                        <ul id="depIcaoSuggestions" class="icao-suggestions"></ul>
                    </div>
                </div>

                <div class="icao-field-group">
                    <label for="arrivalIcao">
                        <i class="fa-solid fa-plane-arrival"></i>Назначение:
                    </label>
                    <div style="position: relative;">
                        <input type="text" id="arrivalIcao" maxlength="4" placeholder="XXXX" />
                        <ul id="arrIcaoSuggestions" class="icao-suggestions"></ul>
                    </div>
                </div>
            </div>

            <!-- Блок Маршрут текст (только в режиме автоподбор) -->
            <div id="routeTextRow" style="display: none; margin-bottom: 15px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                    <label style="margin-bottom: 0;">
                        <i class="fa-solid fa-route"></i> Маршрут:
                    </label>
                    <button id="copyRouteTextBtn" class="icon-button" title="Скопировать текст маршрута">
                        <i class="fa-solid fa-copy"></i>
                    </button>
                </div>
                <div id="routeTextContent" class="route-text-display"></div>
            </div>

            <!-- Блок Запасные -->
            <div style="position: relative;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <label for="alternatesIcao">
                        <i class="fa-solid fa-location-dot"></i>Запасные (максимум 30):
                    </label>
                    <div>
                        <button id="toggleAlternatesViewBtn" class="icon-button" title="Переключить вид">
                            <i class="fa-solid fa-eye"></i>
                        </button>
                        <button id="copyAlternatesBtn" class="icon-button" title="Скопировать запасные аэродромы">
                            <i class="fa-solid fa-copy"></i>
                        </button>
                        <button id="deleteAlternatesBtn" class="icon-button" title="Удалить запасные аэродромы">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </div>
                </div>
                <textarea id="alternatesIcao" rows="3" placeholder="XXXX XXXX ..."
                    style="width: 100%; resize: vertical; overflow-y: auto; resize: none;"></textarea>
                <div id="alternatesChipsContainer" class="alternates-chips-container" style="display: none;">
                    <!-- Плашки будут здесь -->
                    <input type="text" id="alternatesChipsInput" maxlength="4" placeholder="XXXX" />
                </div>
                <ul id="altsIcaoSuggestions" class="icao-suggestions"></ul>
            </div>

            <div class="modal-button-group">
                <button id="selectFlightBtn" style="display: none;">
                    <i class="fa-solid fa-cloud-arrow-down"></i>Скачать
                </button>
                <button id="importRouteBtn" style="display: none;">
                    <i class="fa-solid fa-paste"></i>Вставить маршрут
                </button>
                <div class="modal-sep-v"></div>
                <button id="saveRouteBtn" disabled>
                    <i class="fa-solid fa-floppy-disk"></i>Сохранить
                </button>
                <button id="deleteRouteBtn" style="display: none; background-color: var(--col-red);">
                    <i class="fa-solid fa-trash"></i>Удалить
                </button>
            </div>
            <div id="routeImportLoader" style="display: none; margin: 20px auto; text-align: center;">
                <div class="neuro-loader" style="margin: 0 auto 15px;"></div>
                <div class="loading-text">Обработка маршрута...</div>
            </div>
        </div>
        </div>

        <!-- Модальное окно выбора рейса -->
        <div class="modal-backdrop" id="selectFlightModalBackdrop">
            <div class="modal">
                <button class="modal-close-btn" id="closeSelectFlightModalBtn">
                    <i class="fas fa-times"></i>
                </button>
                <h2>Выбрать рейс</h2>
            
                <div class="modal-content-scrollable">
                    <div class="flight-selection-row">
                        <div class="flight-number-group">
                            <label for="flightNumberInput">
                                <i class="fa-solid fa-hashtag"></i> SU
                            </label>
                            <input type="number" id="flightNumberInput" placeholder="1234" pattern="\d*" inputmode="numeric" />
                        </div>
                        <div class="flight-date-group">
                            <label for="flightDateInput">
                                <i class="fa-solid fa-calendar-days"></i> Дата (UTC)
                            </label>
                            <div class="date-with-presets">
                                <input type="date" id="flightDateInput" />
                                <button class="small-preset-btn" id="dateTodayBtn">Сегодня</button>
                                <button class="small-preset-btn" id="dateTomorrowBtn">Завтра</button>
                            </div>
                        </div>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <button id="getUpcomingFlightsBtn" class="secondary-button" style="width: 100%;">
                            <i class="fa-solid fa-list-ul"></i> Получить будущие рейсы
                        </button>
                    </div>

                    <div id="upcomingFlightsContainer" class="upcoming-flights-container" style="margin-bottom: 15px;">
                        <!-- Список будущих рейсов -->
                    </div>

                    <div id="flightRouteLoader" style="display: none; margin: 20px auto; text-align: center;">
                        <div class="neuro-loader" style="margin: 0 auto 15px;"></div>
                        <div class="loading-text">Получение данных OFP...</div>
                    </div>
                </div>

                <div class="modal-button-group">
                    <button id="getRouteByFlightBtn">
                        <i class="fa-solid fa-route"></i> Получить маршрут
                    </button>
                </div>
            </div>
        </div>

        <!-- Модальное окно подтверждения импорта маршрута -->
        <div class="modal-backdrop" id="importRouteConfirmModalBackdrop">
            <div class="modal">
                <button class="modal-close-btn" id="closeImportRouteConfirmModalBtn">
                    <i class="fas fa-times"></i>
                </button>
                <h2>Подтвердите маршрут</h2>
                <div id="importRoutePreview" style="margin-bottom: 15px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 8px; word-break: break-all; font-family: monospace; max-height: 200px; overflow-y: auto;"></div>
                <div class="modal-button-group">
                    <button id="importRouteConfirmYesBtn" class="confirm-yes-btn">
                        <i class="fa-solid fa-check"></i>Да
                    </button>
                    <button id="importRouteConfirmNoBtn" class="confirm-no-btn">
                        <i class="fa-solid fa-times"></i>Нет
                    </button>
                </div>
            </div>
        </div>



    <!-- Модальное окно для результата (или уведомления) -->
    <div class="modal-backdrop" id="resultModalBackdrop">
      <div class="modal">
        <button class="modal-close-btn" id="closeResultModalBtn">
          <i class="fas fa-times"></i>
        </button>
        <h2 id="resultModalTitle">Результат</h2>
        <p id="resultModalMessage">Текст...</p>
        <div class="modal-button-group">
          <button id="resultOkBtn">Закрыть</button>
        </div>
      </div>
    </div>

    <!-- No-Connection Modal -->
    <div id="noConnModalBackdrop" class="modal-backdrop">
        <div class="modal no-conn-modal" role="dialog" aria-modal="true">
            <button class="modal-close-btn" id="closeNoConnModalBtn">
                <i class="fas fa-times"></i>
            </button>

            <h2>Нет подключения</h2>

            <ul class="no-conn-list">
                <li>Проверь интернет-соединение.</li>
                <li>Если связи нет — включи режим <b>Оффлайн</b> и <b>повторно</b> запроси погоду, чтобы получить сохраненные данные.</li>
            </ul>

            <button id="openOfflineBtn" class="offline-toggle-btn">
                <i class="fa-solid fa-plane"></i>
                Включить оффлайн
            </button>
        </div>
    </div>


    <!-- Модальное окно для систем захода на посадку -->
    <div class="modal-backdrop" id="landingSystemsModalBackdrop">
        <div class="modal" style="min-width: 350px;">
            <button class="modal-close-btn" id="closeLandingSystemsModalBtn">
                <i class="fas fa-times"></i>
            </button>
            <h2 id="landingSystemsModalCaption">Системы захода на посадку</h2>

            <div id="systemsTab" class="tab-content">
                <!-- Список существующих систем -->
                <div id="landingSystemsList" class="landing-systems-list" style="margin-bottom: 15px;"></div>

                <!-- Блок добавления новой системы в одну строку -->
                <div id="newSystemForm" class="new-system-form">
                    <label for="systemRunwaySelect">ВПП:</label>
                    <select id="systemRunwaySelect" class="no-default-arrow">
                        <!-- Для примера, вставь заглушки. Позже наполнишь динамически -->
                        <option value="12">12</option>
                        <option value="30">30</option>
                    </select>

                    <label for="systemTypeSelect">Тип:</label>
                    <select id="systemTypeSelect" class="no-default-arrow">
                        <option value="ILS (I)">ILS (I)</option>
                        <option value="GLS">GLS</option>
                        <option value="RNAV">RNAV</option>
                        <option value="VOR">VOR</option>
                        <option value="NDB">NDB</option>
                        <option value="LOC">LOC</option>
                    </select>

                    <label for="rvrInput">RVR:</label>
                    <input id="rvrInput" type="number" placeholder="m" style="width: 80px;" />

                    <label for="dhInput">DH/MDH:</label>
                    <input id="dhInput" type="number" placeholder="ft" style="width: 80px;" />

                    <button id="addSystemBtn" style="opacity:0.5;" disabled>Добавить</button>
                </div>
            </div>

            <div id="atisTab" class="tab-content active">
                <div class="atis-row">
                    <label class="atis-label">DEP</label>
                    <label>|</label>
                    <label>ENG:</label>
                    <input type="number" id="atisDep1" maxlength="7" placeholder="0.000" readonly>
                    <label>RUS:</label>
                    <input type="number" id="atisDep2" maxlength="7" placeholder="0.000" readonly>
                </div>
                <div class="atis-row">
                    <label class="atis-label">ARR</label>
                    <label>|</label>
                    <label>ENG:</label>
                    <input type="number" id="atisArr1" maxlength="7" placeholder="0.000" readonly>
                    <label>RUS:</label>
                    <input type="number" id="atisArr2" maxlength="7" placeholder="0.000" readonly>
                </div>
                <div style="justify-content: center; display: flex; gap: 10px; width: 60%; align-self: center; margin: 0 auto;">
                    <button id="editAtisBtn" style="flex: 1;" hidden="">
                        <i class="fa-solid fa-marker" style="margin-right: 5px;"></i>
                        Редактировать
                    </button>
                    <button id="saveAtisBtn" style="flex: 1;" disabled hidden="">
                        <i class="fa-solid fa-floppy-disk" style="margin-right: 5px;"></i>
                        Сохранить
                    </button>
                </div>

            </div>
        </div>
    </div>

    <!-- Модальное окно ограничений ВП -->
    <div class="modal-backdrop" id="limitationsModalBackdrop">
        <div class="modal limitations-modal">
            <button class="modal-close-btn" id="closeLimitationsModalBtn">
                <i class="fas fa-times"></i>
            </button>
            
            <div class="modal-tabs">
                <button class="tab-btn active" data-tab="limitsTab">Ограничения для ВП</button>
                <button class="tab-btn" data-tab="minimaTab">Минимумы</button>
                <button class="tab-btn" data-tab="correctionTab">Поправка</button>
                <button class="tab-btn" data-tab="limitationTab">Limitation</button>
            </div>

            <div class="modal-content-scrollable">
                <!-- Вкладка: Ограничения -->
                <div id="limitsTab" class="tab-pane active">
                    <div class="limitations-grid">
                        <div class="limitations-section">
                            <h3 class="section-title"><i class="fa-solid fa-plane-departure"></i> Взлет</h3>
                            <div class="limitation-card">
                                <div class="card-header"><i class="fa-solid fa-house-chimney-window"></i> Аэродромы</div>
                                <div class="card-value">Категории A, B, B*</div>
                            </div>
                            <div class="limitation-card">
                                <div class="card-header"><i class="fa-solid fa-eye"></i> Видимость / RVR</div>
                                <div class="card-value">≥ 400 м</div>
                            </div>
                            <div class="limitation-card">
                                <div class="card-header"><i class="fa-solid fa-wind"></i> Боковой ветер</div>
                                <div class="card-value">≤ 80%</div>
                                <div class="card-value instructor-value">≤ 100% с инструктором</div>
                            </div>
                        </div>

                        <div class="limitations-section">
                            <h3 class="section-title"><i class="fa-solid fa-plane-arrival"></i> Посадка</h3>
                            <div class="limitation-card">
                                <div class="card-header"><i class="fa-solid fa-house-chimney-window"></i> Аэродромы</div>
                                <div class="card-value">Категории A, B</div>
                                <div class="card-value instructor-value">B* с инструктором</div>
                            </div>
                            <div class="limitation-card">
                                <div class="card-header"><i class="fa-solid fa-eye"></i> Видимость / RVR</div>
                                <div class="card-value">≥ MIN + 200 м (но ≥ 550 м)</div>
                                <div class="card-value instructor-value">≥ MIN (но ≥ 550 м) с инструктором</div>
                            </div>
                            <div class="limitation-card">
                                <div class="card-header"><i class="fa-solid fa-cloud"></i> НГО / ВВ</div>
                                <div class="card-value">≥ DH / MDH (но ≥ 60 м / 200 ft)</div>
                            </div>
                            <div class="limitation-card">
                                <div class="card-header"><i class="fa-solid fa-ruler-horizontal"></i> Дистанция (LDA)</div>
                                <div class="card-value">≥ LDR + 15%</div>
                            </div>
                            <div class="limitation-card">
                                <div class="card-header"><i class="fa-solid fa-wind"></i> Боковой ветер</div>
                                <div class="card-value">≤ 80%</div>
                                <div class="card-value instructor-value">≤ 100% с инструктором</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Вкладка: Минимумы -->
                <div id="minimaTab" class="tab-pane">
                    <div class="minima-table-wrapper">
                        <table class="minima-table">
                            <thead>
                                <tr>
                                    <th>Категория захода</th>
                                    <th>Зона приземления</th>
                                    <th>Середина ВПП</th>
                                    <th>Дальний конец</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>CAT I или выше<br><small>(без осевых огней)</small></td>
                                    <td rowspan="4">≥ MIN</td>
                                    <td>≥ 300 м</td>
                                    <td>≥ 150 м</td>
                                </tr>
                                <tr>
                                    <td>CAT I или выше<br><small>(с осевыми огнями)</small></td>
                                    <td rowspan="2">≥ 125 м</td>
                                    <td rowspan="2">≥ 75 м</td>
                                </tr>
                                <tr>
                                    <td>CAT II / IIIA</td>
                                </tr>
                                <tr>
                                    <td>CAT IIIB</td>
                                    <td>≥ MIN</td>
                                    <td>≥ MIN</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Вкладка: Поправка -->
                <div id="correctionTab" class="tab-pane">
                    <div class="minima-table-wrapper">
                        <table class="minima-table correction-table">
                            <thead>
                                <tr>
                                    <th rowspan="2">Темпера-<br>тура (°C)</th>
                                    <th colspan="11">Высота контрольной точки над уровнем аэродрома (ft)</th>
                                </tr>
                                <tr>
                                    <th>200</th>
                                    <th>300</th>
                                    <th>400</th>
                                    <th>500</th>
                                    <th>600</th>
                                    <th>700</th>
                                    <th>800</th>
                                    <th>900</th>
                                    <th>1000</th>
                                    <th>1500</th>
                                    <th>2000</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>0</td>
                                    <td>20</td><td>20</td><td>30</td><td>30</td><td>40</td><td>40</td><td>50</td><td>50</td><td>60</td><td>90</td><td>120</td>
                                </tr>
                                <tr>
                                    <td>-10</td>
                                    <td>20</td><td>30</td><td>40</td><td>50</td><td>60</td><td>70</td><td>80</td><td>90</td><td>100</td><td>150</td><td>200</td>
                                </tr>
                                <tr>
                                    <td>-20</td>
                                    <td>30</td><td>50</td><td>60</td><td>70</td><td>90</td><td>100</td><td>120</td><td>130</td><td>140</td><td>210</td><td>280</td>
                                </tr>
                                <tr>
                                    <td>-30</td>
                                    <td>40</td><td>60</td><td>80</td><td>100</td><td>120</td><td>140</td><td>150</td><td>170</td><td>190</td><td>280</td><td>380</td>
                                </tr>
                                <tr>
                                    <td>-40</td>
                                    <td>50</td><td>80</td><td>100</td><td>120</td><td>150</td><td>170</td><td>190</td><td>220</td><td>240</td><td>360</td><td>480</td>
                                </tr>
                                <tr>
                                    <td>-50</td>
                                    <td>60</td><td>90</td><td>120</td><td>150</td><td>180</td><td>210</td><td>240</td><td>270</td><td>300</td><td>450</td><td>590</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Вкладка: Limitation -->
                <div id="limitationTab" class="tab-pane">
                    <div class="limitations-grid">

                        <!-- 3. TAXI / GROUND SPEED LIMITS -->
                        <div class="limitations-section">
                            <h3 class="section-title"><i class="fa-solid fa-truck-plane"></i> Taxi / Ground Speed Limits</h3>
                            <div class="minima-table-wrapper">
                                <table class="minima-table">
                                    <thead>
                                        <tr>
                                            <th>Area</th>
                                            <th>Limit</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr><td>Apron</td><td>10 kt</td></tr>
                                        <tr><td>Taxiway straight</td><td>30 kt</td></tr>
                                        <tr><td>Taxiway ≤45° turn</td><td>20 kt</td></tr>
                                        <tr><td>Taxiway >45° turn</td><td>5–10 kt</td></tr>
                                        <tr><td>Runway</td><td>60 kt</td></tr>
                                        <tr><td>Rapid exit ≤45°</td><td>45 kt</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- 4. VERTICAL SPEED LIMITS -->
                        <div class="limitations-section">
                            <h3 class="section-title"><i class="fa-solid fa-arrows-up-down"></i> Vertical Speed Limits</h3>
                            <div class="minima-table-wrapper">
                                <table class="minima-table">
                                    <thead>
                                        <tr>
                                            <th>Height</th>
                                            <th>Max Vertical Speed</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr><td>1000 ft to assigned ALT/FL</td><td>1500 fpm (1000 if traffic)</td></tr>
                                        <tr><td>3000 – 2000 ft AAL</td><td>2000 fpm</td></tr>
                                        <tr><td>2000 – 1000 ft AAL</td><td>1500 fpm</td></tr>
                                        <tr><td>Below 1000 ft AAL</td><td>1000 fpm</td></tr>
                                        <tr><td>Non-standard approach <1000</td><td>>1000 fpm → briefing req</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- 7. WEIGHT LIMITATIONS (kg) -->
                        <div class="limitations-section">
                            <h3 class="section-title"><i class="fa-solid fa-weight-hanging"></i> Weight Limitations (kg)</h3>
                            <div class="minima-table-wrapper">
                                <table class="minima-table">
                                    <tbody>
                                        <tr><td>Zero Fuel</td><td>61,688</td></tr>
                                        <tr><td>Landing</td><td>66,360</td></tr>
                                        <tr><td>Takeoff</td><td>79,015</td></tr>
                                        <tr><td>Taxi (alt)</td><td>79,242</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!-- 1. LOW VISIBILITY / APPROACH & LANDING LIMITS -->
                        <div class="limitations-section">
                            <h3 class="section-title"><i class="fa-solid fa-eye-low-vision"></i> LVO</h3>
                            <div class="minima-table-wrapper">
                                <table class="minima-table">
                                    <thead>
                                        <tr>
                                            <th>CATEGORY</th>
                                            <th>RVR</th>
                                            <th>DH</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr><td>CAT I</td><td>550 m</td><td>200 ft (60 m)</td></tr>
                                        <tr><td>CAT II</td><td>300 m</td><td>100 ft (30 m)</td></tr>
                                        <tr><td>CAT IIIA</td><td>175 m</td><td>50 ft (15 m)</td></tr>
                                        <tr><td>CAT IIIB</td><td>50 m</td><td>NO DH</td></tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="limitation-card">
                                <div class="card-header">Takeoff RVR</div>
                                <div class="card-value">125 m</div>
                            </div>
                        </div>

                        <!-- 11. ENGINE STARTER LIMITS -->
                        <div class="limitations-section">
                            <h3 class="section-title"><i class="fa-solid fa-bolt"></i> Engine Starter Limits</h3>
                            <div class="limitation-card">
                                <div class="card-header">Normal start</div>
                                <div class="card-value">Max 2 min per attempt</div>
                                <div class="card-value">Min 10 sec between attempts</div>
                            </div>
                            <div class="limitation-card">
                                <div class="card-header">Extended motoring</div>
                                <div class="card-value">1-2: 15 min (2 min cooling)</div>
                                <div class="card-value">3+: 5 min (10 min cooling)</div>
                            </div>
                            <div class="limitation-card">
                                <div class="card-header">After 3 aborted starts</div>
                                <div class="card-value">15 min cooling</div>
                            </div>
                        </div>

                        <!-- 18. COLD SOAKED FUEL FROST -->
                        <div class="limitations-section">
                            <h3 class="section-title"><i class="fa-solid fa-icicles"></i> Cold Soaked Fuel Frost</h3>
                            <div class="limitation-card">
                                <div class="card-header">Takeoff prohibited if:</div>
                                <div class="card-value">• OAT &lt; +4°C / Fuel temp &lt; -16°C</div>
                                <div class="card-value">• Frost beyond allowed area</div>
                                <div class="card-value">• Any precipitation / visible moisture</div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно для расчета ветра -->
    <div class="modal-backdrop" id="windDirectionModalBackdrop">
        <div class="modal wind-direction-modal">
            <button class="modal-close-btn" id="closeWindDirectionModalBtn">
                <i class="fas fa-times"></i>
            </button>
            <h2><i class="fa-solid fa-wind"></i> Расчет ветра и времени</h2>

            <div class="compact-input-group">
                <!-- Аэропорты в одной строке -->
                <div class="dual-input-row">
                    <div class="airport-input compact">
                        <label>Вылет:</label>
                        <input type="text" id="windDepIcao" placeholder="ICAO" maxlength="4"
                            pattern="[A-Z]*" style="text-transform: uppercase;">
                        <ul class="icao-suggestions"></ul>
                    </div>

                    <div class="airport-input compact">
                        <label>Назначение:</label>
                        <input type="text" id="windArrIcao" placeholder="ICAO" maxlength="4"
                            pattern="[A-Z]*" style="text-transform: uppercase;">
                        <ul class="icao-suggestions"></ul>
                    </div>
                </div>

                <!-- Топливо в одной строке -->
                <div class="dual-input-row">
                    <div class="fuel-input compact">
                        <label>FINAL RESERVE <small>(кг)</small>:</label>
                        <input type="number" id="finalReserve" min="0" step="1" placeholder="0">
                    </div>

                    <div class="fuel-input compact">
                        <label>REMF <small>(кг)</small>:</label>
                        <input type="number" id="remf" min="0" step="1" placeholder="0">
                    </div>
                </div>
            </div>

            <div class="wind-type-select compact">
                <label>Тип ветра:</label>
                <select id="windTypeSelect">
                    <option value="HW">Встречный (Headwind)</option>
                    <option value="TL">Попутный (Tailwind)</option>
                </select>
            </div>

            <div class="results-container">
                <div class="result-box">
                    <i class="fa-solid fa-compass"></i>
                    <div class="result-content">
                        <span id="windDirectionValue">—/—</span>
                        <small>Направление</small>
                    </div>
                </div>

                <div class="result-box">
                    <i class="fa-solid fa-clock"></i>
                    <div class="result-content">
                        <span id="holdingTimeValue">—</span>
                        <small>Минут ожидания</small>
                    </div>
                </div>
            </div>

            <div class="modal-button-group compact">
                <button id="calculateWindBtn"><i class="fa-solid fa-calculator"></i> Рассчитать</button>
            </div>
        </div>
    </div>

    <script src="appdata.js"></script>
    <script src="main.js"></script>
    <script src="extra.js"></script>
    <script src="extraTwo.js"></script>
    <script src="search.js"></script>
    <script src="airportSystems.js"></script>
    <script src="synchash.js"></script>
    <script src="wakeLock.js"></script>


    <script>
        navigator.serviceWorker
            .register("./service-worker.js")
            .then(() => console.log("Service Worker зарегистрирован"))
            .catch(error => console.error("Ошибка регистрации Service Worker:", error));
    </script>

</body>

</html>
